# integration
This repository is a combination of 3 previous repositories: database, webapp and api. The relevant information about running all of the individual components are below.

The three functions integration currently serve are:
* python run.py --new
* python run.py --sync
* python run.py --run


## --new
This command will create a new database file based on the name in the config file and download all the relevant content from AWS S3 into the static folder. This should only be run once when you first setup the box.

## --sync
This command syncs the boxes current data with the database on AWS. This includes deleting missing files, pushing download count and downloading new files

## --run
This command runs the server, webapp and api all in one :) 

# database

This database repository contains the functionality to SYNC our LOCAL server with the CLOUD server in terms of file metadata and the actual files

## Installation
This package requires the following packages to be installed as follows
* `pip install sqlalchemy`
* `pip install boto3`
* `pip install pymysql`
* `pip install boto`


## Running Sync

### Obtaining config.json
The config.json for this repository can be found in the Google Drive/Config Files/config.json

### Editing sync.py
Sync.py contains the following relevant functions:
* copyContentData(boxID, localdb, clouddb)
* syncBoxes(boxID, localdb, clouddb)

copyContentData is run the first time (and only the first time) you sync the boxes to grab all the data. The database information is written to a sqlite database called eisvsfiles.db while the physical files are downloaded into a folder labeled by the box ID.

syncBoxes runs the entire stack as follows
1. Delete Missing Files
2. Push Download Count
3. Pull Content Data

### Running sync.py
1. Open run.py
2. Edit the box id to the box desired
3. If running for the first time, create a blank file named eisvsfiles.db and then run  `python run.py` with createBlankLocalTable and copyContentData functions uncommented
4. If not running for the first time, comment out createBlankLocalTable and copyContentData and uncomment syncBoxes! Then run
`python run.py`

# api
The api repository is a REST client used by our webapp to access the information in the database.

NOTE: In the future, the integration file will deal with the api and generating the database files.

## Setup
1. Clone `eisvillageserver/database` and run the copyContentData and syncBoxes function to obtain an up to date copy of `eisvsfiles.db`
2. Copy the generated `eisvsfiles.db` into the root of this repository
3. Run `pip install flask`
4. Run `pip install flask_restful`
5. Run `pip install sqlalchemy`
6. Run `pip install flask-cors`
7. Run `python api.py`

## API
Using your favourite rest client.:
### GET /categories
Returns a list of categories of files
### GET /categories/documents
Returns a list of files with the category Documents
### GET /categories/images
Returns a list of files with the category Images
### GET /categories/music
Returns a list of files with the category Music
### GET /categories/apps
TODO: Returns a list of files with the category Applications
### GET /categories/videos
Returns a list of files with category Videos
### POST /:id
TODO: Increase the download count of the file with UID id

# webapp
The webapp repository contains the UI code involved with the village facing web application. This web application allows you to download files hosted by the village server.

## Setup
1. Install Ruby (https://www.ruby-lang.org/en/)
2. Compile the sass into css by running `compass watch` in the terminal at the root of this repository
3. Run `sync.py` from the database repository. Copy the downloaded files from the (in the boxid folder) from the database repository into the root of this repository
4. Copy `eisvsfiles.db` into the api repository generated by sync.py
5. Run `python api.py` in the api repository to start the api server
6. In a new command line window run `python server.py`
7. Navigate to `localhost:1234` to view the webapp!
